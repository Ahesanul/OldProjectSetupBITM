@model StockManageWeb.Models.SalesVm
@{
    /**/

    /**/

    /**/

    ViewBag.Title = "Add";

}

<h2>Add</h2>

@if (Model != null)
{

    <form method="post">
        <div class="row">
            <div class="card col-5">

                <div class="card-body">
                    <h2>Customer</h2>
                    <div class="card ">
                        <div class="card-body">

                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @Html.LabelFor(c => c.CustomerID, null, new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    @*<input type="text" class="form-control" id="Address" name="Address" placeholder="Address">*@
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*<select class="form-control" id="customer">
                                            <option value=0>select--</option>
                                            @foreach (var item in Model.CustomerList)
                                            {

                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>*@
                                    @Html.DropDownListFor(c => c.CustomerID, Model.CustomerList, "--Select--", new { @class = "form-control", id = "customer" })
                                </div>
                            </div>

                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Date</label>*@
                                @Html.Label("DateLabel", "Date", new { @class = "control-label col-md-5" })

                                <div class="col-sm-7">
                                    <input type="date" class="form-control" id="DateText" name="Date">
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("DateText", null, new { @class = "form-control" })*@
                                </div>
                            </div>

                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @Html.Label("LayalitypointLabel", "Layality point", new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    <input type="text" class="form-control" id="LayalitypointText" readonly>
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("LayalitypointText", null, new { @class = "form-control" })*@
                                </div>
                            </div>


                        </div>
                    </div>



                    <h2>Product</h2>

                    <div class="card">
                        <div class="card-body">

                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @Html.LabelFor(c => c.Purchase.ProductID, null, new { @class = "control-label col-md-5" })
                                <div class="col-md-7">
                                    @*<input type="text" class="form-control" id="Address" name="Address" placeholder="Address">*@
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @Html.DropDownListFor(c => c.PurchaseID, Model.ProductList.Distinct(), "--Select--", new { @class = "form-control", id = "product" })
                                </div>
                            </div>



                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @Html.Label("AvailableQuantityLabel", "Available Quantity", new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    <input type="text" class="form-control" id="AvailableQuantity" readonly>
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox( null, new { @class = "form-control" })*@
                                </div>
                            </div>


                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @Html.Label("QuantityLabel", "Quantity", new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    <input type="text" class="form-control" id="QuantityText" name="quantity" placeholder="Quantity">
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("QuantityText", null, new { @class = "form-control" })*@
                                </div>
                            </div>



                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @Html.Label("MRP", "MRP", new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    <input type="text" class="form-control" id="MRPText" name="MRP" placeholder="MRP">
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("MRPText", null, new { @class = "form-control" })*@
                                </div>
                            </div>



                            <div class="form-group row">
                                @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @Html.Label("TotalMRPLabel", "Total MRP", new { @class = "control-label col-md-5" })
                                <div class="col-sm-7">
                                    <input type="text" class="form-control" id="TotalMRP" name="TotalMRP" readonly>
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("TotalMRPText", null, new { @class = "form-control" })*@
                                </div>
                            </div>


                            <div class="form-group row">
                                <label class="control-label col-md-5"> </label>
                                @*<label class="control-label col-md-4">Layality point</label>*@
                                @*@Html.Label("TotalMRPLabel", "Total MRP", new { @class = "control-label col-md-5" })*@
                                <div class="col-sm-7">
                                    <input type="button" class="btn btn-primary" id="btnAdd" value="Add">
                                    @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                    @*@Html.TextBox("TotalMRPText", null, new { @class = "form-control" })*@
                                </div>
                            </div>

                        </div>

                    </div>
                </div>



            </div>


            <div class="col-lg-7" style="margin-top:15%">

                <h2>Product Details</h2>
                <div class="card">


                    <div class="card-body">


                        <table class="table table-striped table-avatar" id="">
                            <thead>
                                <tr>
                                    <th scope="col">Sl</th>
                                    <th scope="col">Product</th>
                                    <th scope="col">Quantity</th>
                                    <th scope="col">MRP</th>
                                    <th scope="col">Total MRP</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="tbl"></tbody>
                        </table>


                        <br /><br />


                        <div class="form-group row">
                            @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                            @*<label class="control-label col-md-4">Layality point</label>*@
                            @Html.Label("Payable", "Payable", new { @class = "control-label col-md-5" })
                            <div class="col-sm-7">
                                <input type="text" class="form-control" id="PayableText" placeholder="Payable">
                                @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                @*@Html.TextBox("MRPText", null, new { @class = "form-control" })*@
                            </div>
                        </div>


                        <div class="form-group row">
                            @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                            @*<label class="control-label col-md-4">Layality point</label>*@
                            @Html.Label("Discount(%)", "Discount(%)", new { @class = "control-label col-md-5" })
                            <div class="col-sm-7">
                                <input type="text" class="form-control" id="DiscountP" Text" placeholder="Discount(%)">
                                @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                @*@Html.TextBox("MRPText", null, new { @class = "form-control" })*@
                            </div>
                        </div>


                        <div class="form-group row">
                            @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                            @*<label class="control-label col-md-4">Layality point</label>*@
                            @Html.Label("Discount", "Discount", new { @class = "control-label col-md-5" })
                            <div class="col-sm-7">
                                <input type="text" class="form-control" id="DiscountText" placeholder="Discount">
                                @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                @*@Html.TextBox("MRPText", null, new { @class = "form-control" })*@
                            </div>
                        </div>


                        <div class="form-group row">
                            @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                            @*<label class="control-label col-md-4">Layality point</label>*@
                            @Html.Label("Grand-Total", "Grand-Total", new { @class = "control-label col-md-5" })
                            <div class="col-sm-7">
                                <input type="text" class="form-control" value="0" id="GrandTotalText" name="GrandTotal" placeholder="Grand Total">
                                @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                @*@Html.TextBox("MRPText", null, new { @class = "form-control" })*@
                            </div>
                        </div>


                        <div class="form-group row">
                            @*<label class="control-label col-sm-2" for="Address">Address:</label>*@
                            @*<label class="control-label col-md-4">Layality point</label>*@
                            @Html.Label("btnSave", " ", new { @class = "control-label col-md-5" })
                            <div class="col-sm-7">
                                @*<input type="text" class="form-control" id="Address" name="Address" placeholder="Address">*@
                                @*@Html.TextBoxFor(c => c.DistrictID, null, new { @class = "form-control"})*@
                                <input class="btn btn-success" type="submit" value="Save" />
                            </div>
                        </div>

                    </div>

                </div>

            </div>
        </div>
    </form>

}

@section Scripts
{
    <script>

        $("#MRPText").focusout(
            function () {
                var quantity = $('#QuantityText').val();
                var mrp = $("#MRPText").val();
                var totalmrp = quantity * mrp;
                $("#TotalMRP").val(totalmrp);
            }
        );
        var sl = 0;
        $("#btnAdd").click(
            function () {

                var sales = getStudentRecord();
                var row = getRowForStudent(sales);
                $("#tbl").append(row);
                sl++;
                var grand = parseInt($("#GrandTotalText").val());
                var MRP = parseInt($("#TotalMRP").val());
                grand = grand + MRP;
                $("#GrandTotalText").val(grand.toString());

                $("#DiscountP").val($("#LayalitypointText").val().toString())
                var discount = parseInt($("#DiscountP").val());
                var disamount = (discount * grand) / 100;
                $("#DiscountText").val(disamount.toString());




                $("#PayableText").val((grand - disamount).toString());

                alert("done");
            }
        );

        function getStudentRecord() {
            var productId = $("#product option:selected").val();
            var productName = $("#product option:selected").text();
            var quantity = $("#QuantityText").val();
            var MRP = $("#MRPText").val();
            var totalMRP = $("#TotalMRP").val();

            return {
                ProductID: productId, ProductName: productName, quantity: quantity, MRP: MRP, totalMRP: totalMRP
            }

        }

        function getRowForStudent(sales) {

            var productHidden = "<input type='hidden' name='sales[" + sl + "].PurchaseID' value=" + sales.ProductID + " />";
            var quantityHidden = "<input type='hidden' name='sales[" + sl + "].quantity' value=" + sales.quantity + " />";
            var MRPHidden = "<input type='hidden' name='sales[" + sl + "].MRP' value=" + sales.MRP + " />";
            var totalMRPHidden = "<input type='hidden' name='sales[" + sl + "].TotalMRP' value=" + sales.totalMRP + " />";
            var action = " <input type='button' value='Delete'/>";

            var tr = "<tr>";
            var SLCell = "<td>" + sl + "</td>";
            var productCell = "<td>" + productHidden + sales.ProductName + "</td>";
            var quantityCell = "<td>" + quantityHidden + sales.quantity + "</td>";
            var MRPCell = "<td>" + MRPHidden + sales.MRP + "</td>";
            var totalMRPCell = "<td>" + totalMRPHidden + sales.totalMRP + "</td>";
            var btnPCell = "<td> " + action + " </td>";
            var endTr = "</tr>";
            var row = tr + SLCell + productCell + quantityCell + MRPCell + totalMRPCell + btnPCell + endTr;

            return row;
        }

        $('#customer').change(function () {
            var CustomerID = $('#customer').val();
            var jsonData = { customerID: CustomerID };
            // ajax request to student/getbydistrict

            $.ajax(
                {
                    url: "/Sale/GetbyID",
                    type: "POST",
                    data: jsonData,
                    success: function (aCustomer) {

                        $("#LayalitypointText").val(aCustomer);

                    },
                    error: function (response) {
                        alert(response);
                    }

                }


            );


        });




        $('#product').change(function () {
            var ProductID = $('#product').val();
            var jsonData = { productID: ProductID };

            $.ajax(
                {
                    url: "/Sale/GetbyID2",
                    type: "POST",
                    data: jsonData,
                    success: function (aProduct) {

                        $("#AvailableQuantity").val(aProduct);

                    },
                    error: function (response) {
                        alert(response);
                    }

                }
            );


            $.ajax(
                {
                    url: "/Sale/GetbyIDReorder",
                    type: "POST",
                    data: jsonData,
                    success: function (aProduct) {

                        if (aProduct >= $("#AvailableQuantity").val()) {
                            alert("Low Quantity");
                        }


                    },
                    error: function (response) {
                        alert(response);
                    }

                }
            );



        });


    </script>
    <script src="~/Scripts/jquery.validate.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>
}
